<!DOCTYPE html>
<html lang="en">
<head></head>
<body>
<h2>flatMap (same as map().mergeAll()) (mergeMap in rx5)</h2>
<h3>flatMap is an alias for mergeMap</h3>
<script src="/lib/Rx5.umd.js"></script>
<script>
  let unlike = -1;
  let likeCount = 0;

  let Tweet = function (str, color) {
    this.col = color,
      this.text = str;
    this.likes = new Rx.Subject();
  };

  let tweetsSubject$ = new Rx.Subject();

  tweetsSubject$.subscribe((tweet) => {
    log(tweet.text, tweet.col);
  });

  tweetsSubject$
    .do((x) => console.log("HERE", x))
    .flatMap((tweet) => tweet.likes)
    .do((x) => log("AND HERE " + x, 'orange'))
    .subscribe((likeAction) => {
      likeCount = likeCount + likeAction;
      log(`Total Likes: ${likeCount}`);
    });

  let firstTweet = new Tweet('first tweet', 'green');
  let secondTweet = new Tweet('second tweet', 'red');

  tweetsSubject$.next(firstTweet);
  tweetsSubject$.next(secondTweet);

  firstTweet.likes.next(1);
  secondTweet.likes.next(1);
  secondTweet.likes.next(1);
  secondTweet.likes.next(1);

</script>

</body>
</html>